<% content_for :title, "#{@coffee_bean.display_name} | Vibe Coffee" %>

<% meta_parts = [] %>
<% meta_parts << "from #{@coffee_bean.origin}" if @coffee_bean.origin.present? %>
<% meta_parts << "by #{@coffee_bean.producer}" if @coffee_bean.producer.present? %>
<% meta_parts << @coffee_bean.variety.to_sentence if @coffee_bean.variety.present? && @coffee_bean.variety.any? %>
<% meta_parts << @coffee_bean.process.to_sentence + " process" if @coffee_bean.process.present? && @coffee_bean.process.any? %>
<% meta_parts << "Tasting notes: #{@coffee_bean.tasting_notes.to_sentence}" if @coffee_bean.tasting_notes.present? && @coffee_bean.tasting_notes.any? %>
<% content_for :meta_description, "#{@coffee_bean.display_name}#{meta_parts.any? ? ' - ' + meta_parts.join('. ') : ''}".truncate(160) %>

<% content_for :og_title, @coffee_bean.display_name %>
<% content_for :og_type, "product" %>
<% if @coffee_bean.images.attached? %>
  <% content_for :og_image, url_for(@coffee_bean.images.first) %>
<% end %>

<div class="mb-4">
  <h1 class="title"><%= @coffee_bean.display_name %></h1>
</div>

<% if @coffee_bean.images.attached? %>
  <div class="flex gap-2">
    <% @coffee_bean.images.each do |image| %>
      <%= image_tag image.variant(resize_to_fill: [384, 384]), class: "h-48 w-48 object-cover rounded" %>
    <% end %>
  </div>
<% end %>

<%= render "coffee_beans/details", coffee_bean: @coffee_bean %>

<% if @coffee_bean.published_recipes.any? %>
  <div class="mt-8">
    <h2 class="font-bold text-xl mb-4">Recipes</h2>
    <div class="space-y-2">
      <% @coffee_bean.published_recipes.each do |recipe| %>
        <%= link_to brew_path(recipe.slug), class: "block card p-4 hover:bg-gray-50" do %>
          <div class="flex items-center justify-between">
            <div>
              <h3 class="font-semibold"><%= recipe.name %></h3>
              <span class="text-sm text-gray-600"><%= recipe.brew_method_name %></span>
            </div>
            <span class="text-gray-400">&rarr;</span>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
<% end %>
